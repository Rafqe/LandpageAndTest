<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="shortcut icon"
      href="assets/Amblify_logo_noText.png"
      type="image/x-icon"
    />
    <meta name="description" content="" />
    -

    <title>Amblyfy - Screen Early. See Clearly.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
      const supabaseClient = supabase.createClient(
        "https://temkhtebkbcidecterqz.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRlbWtodGVia2JjaWRlY3RlcnF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5MzQwMDYsImV4cCI6MjA2NDUxMDAwNn0.6lK1CuirhFNRB-RVwMc-QPwirWlPUlNEbCjTPOg7B7E"
      );
    </script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "brand-dark-blue": "#144475",
              "brand-cyan": "#00AEC2",
              "brand-dark-green": "#007262",
              "brand-light-green": "#75BC7E",
              "brand-yellow": "#E1DB1D",
              "brand-pale-green": "#CAD76A",
            },
          },
        },
      };
    </script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f8fafc;
        margin: 0;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        overflow-y: auto; /* Enable vertical scrolling */
        position: relative; /* Ensure proper stacking context */
      }

      html {
        scroll-behavior: smooth;
        height: 100%;
        overflow-y: auto; /* Enable vertical scrolling */
      }

      main {
        flex: 1;
        position: relative; /* Ensure proper stacking context */
        overflow-y: auto; /* Enable vertical scrolling */
      }

      /* Add padding to sections to account for fixed navbar */
      section {
        scroll-margin-top: 80px;
        position: relative; /* Ensure proper stacking context */
      }

      /* Styles for scroll-triggered animations */
      .fade-in-up {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease-out, transform 0.6s ease-out;
      }
      .fade-in-up.is-visible {
        opacity: 1;
        transform: translateY(0);
      }
    </style>
    <style>
      body {
        font-family: "Inter", sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background-color: #f0f2f5;
        margin: 0;
        overflow: hidden; /* Prevent body scroll if symbols go out of bounds */
      }

      /* Custom styles for the Snellen symbols container */
      .snellen-container {
        position: absolute;
        inset: 0;
        background-color: transparent;
        border: none;
        border-radius: 0;
        overflow: hidden;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
        z-index: 1;
        pointer-events: none;
      }

      /* Show container on parent hover */
      #testEyesContainer:hover .snellen-container,
      #startTreatmentContainer:hover .snellen-container,
      #consistencyContainer:hover .snellen-container {
        opacity: 1;
      }

      /* Styles for individual Snellen symbols */
      .snellen-symbol,
      .start-symbol,
      .consistency-symbol {
        position: absolute;
        color: rgba(255, 255, 255, 0.3);
        font-weight: bold;
        user-select: none;
        pointer-events: none;
        line-height: 1;
        transition: transform 0.2s ease-out;
      }

      .start-symbol img,
      .consistency-symbol img {
        width: 20px;
        height: 20px;
        opacity: 0.3;
      }
    </style>
  </head>
  <body class="text-gray-800">
    <header
      class="bg-white shadow-md py-4 px-6 md:px-12 fixed w-full z-10 top-0"
    >
      <nav class="container mx-auto flex justify-between items-center">
        <a
          href="#home"
          class="text-2xl font-bold text-brand-dark-blue rounded-md p-2 hover:bg-gray-100 transition-colors"
        >
          <img
            src="assets/Amblify_logo_zilsfix.png"
            alt="Amblyfy"
            class="h-10"
          />
        </a>

        <div class="hidden md:flex space-x-6">
          <a
            href="#home"
            class="text-gray-600 hover:text-brand-dark-blue font-medium transition-colors rounded-md px-3 py-2"
            >Home</a
          >
          <a
            href="#steps"
            class="text-gray-600 hover:text-brand-dark-blue font-medium transition-colors rounded-md px-3 py-2"
            >Steps</a
          >
          <a
            href="#about"
            class="text-gray-600 hover:text-brand-dark-blue font-medium transition-colors rounded-md px-3 py-2"
            >About Us</a
          >
          <a
            href="#contact"
            class="text-gray-600 hover:text-brand-dark-blue font-medium transition-colors rounded-md px-3 py-2"
            >Contact</a
          >
          <a
            href="pretestPage.html"
            class="text-gray-600 hover:text-brand-dark-blue font-medium transition-colors rounded-md px-3 py-2"
            >Eye Test</a
          >
        </div>

        <button
          id="mobile-menu-button"
          class="md:hidden text-gray-600 focus:outline-none focus:ring-2 focus:ring-brand-dark-blue rounded-md p-2"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
            ></path>
          </svg>
        </button>
      </nav>

      <div
        id="mobile-menu"
        class="md:hidden hidden bg-white py-2 mt-2 border-t border-gray-200"
      >
        <a
          href="#home"
          class="block px-4 py-2 text-gray-700 hover:bg-brand-pale-green hover:text-brand-dark-blue transition-colors rounded-md mx-2"
          >Home</a
        >
        <a
          href="#steps"
          class="block px-4 py-2 text-gray-700 hover:bg-brand-pale-green hover:text-brand-dark-blue transition-colors rounded-md mx-2"
          >Steps</a
        >
        <a
          href="#about"
          class="block px-4 py-2 text-gray-700 hover:bg-brand-pale-green hover:text-brand-dark-blue transition-colors rounded-md mx-2"
          >About Us</a
        >
        <a
          href="#contact"
          class="block px-4 py-2 text-gray-700 hover:bg-brand-pale-green hover:text-brand-dark-blue transition-colors rounded-md mx-2"
          >Contact</a
        >
        <a
          href="pretestPage.html"
          class="block px-4 py-2 text-gray-700 hover:bg-brand-pale-green hover:text-brand-dark-blue transition-colors rounded-md mx-2"
          >Eye Test</a
        >
      </div>
    </header>

    <main class="pt-20">
      <section
        id="home"
        class="bg-gradient-to-b from-brand-dark-blue to-brand-cyan text-white py-20 px-6 md:px-12 text-center flex items-center justify-center min-h-[calc(100vh-80px)]"
      >
        <div class="max-w-3xl mx-auto">
          <h1
            class="text-4xl md:text-6xl font-extrabold leading-tight mb-6 rounded-lg p-2 bg-white bg-opacity-10 shadow-lg"
          >
            Screen Early See Clearly
          </h1>
          <p class="text-lg md:text-xl mb-8 opacity-90">
            We solve the challenges parents face when treating children with
            amblyopia, also known as "lazy eye." Our greatest mission is to
            create a comprehensive service that will make the treatment journey
            easier for parents, shorten the healing process, and empower
            families along the way.
          </p>
          <a
            href="#steps"
            class="inline-block bg-white text-brand-dark-blue font-bold py-3 px-8 rounded-full shadow-lg hover:bg-brand-light-green hover:scale-105 transition-all duration-300 ease-in-out transform"
          >
            Learn More
          </a>
        </div>
      </section>

      <section
        id="steps"
        class="py-16 px-6 md:px-12 bg-gradient-to-br from-white to-gray-100"
      >
        <div class="container mx-auto text-center">
          <h2
            class="text-3xl md:text-4xl font-bold text-brand-dark-blue mb-12 fade-in-up"
          >
            3 Steps to Great Vision
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div
              class="bg-gradient-to-b from-brand-cyan to-brand-dark-green p-8 rounded-lg shadow-lg hover:shadow-2xl transition-all duration-300 border border-brand-dark-blue fade-in-up relative overflow-hidden hover:bg-opacity-90 hover:scale-[1.02] cursor-pointer"
              id="testEyesContainer"
              onclick="window.location.href='pretestPage.html'"
            >
              <div
                id="snellenAnimationContainer"
                class="snellen-container absolute inset-0"
              ></div>
              <div class="text-brand-cyan mb-4 relative z-10">
                <img
                  src="assets/testEyes.png"
                  alt="Test Your Eyes"
                  class="w-20 h-20 mx-auto"
                />
              </div>
              <h3 class="text-xl text-white font-semibold mb-4 relative z-10">
                Test Your Eyes
              </h3>
              <p class="text-white relative z-10">
                Amblyfy offers a comprehensive eye test that can be completed in
                just a few minutes to determine if your child might have
                amblyopia.
              </p>
            </div>
            <div
              class="bg-gradient-to-b from-brand-dark-green to-brand-light-green p-8 rounded-lg shadow-lg hover:shadow-2xl transition-all duration-300 border border-brand-dark-blue fade-in-up relative overflow-hidden hover:bg-opacity-90 hover:scale-[1.02]"
              id="startTreatmentContainer"
            >
              <div
                id="startAnimationContainer"
                class="snellen-container absolute inset-0"
              ></div>
              <div class="text-brand-cyan mb-4 relative z-10">
                <img
                  src="assets/start.png"
                  alt="Start Treatment"
                  class="w-20 h-20 mx-auto"
                />
              </div>
              <h3 class="text-xl text-white font-semibold mb-4 relative z-10">
                Start Treatment
              </h3>
              <p class="text-white relative z-10">
                With the results of the eye tests, you can start the treatment
                by connecting with an eye specialist. And start the journey to a
                clear vision.
              </p>
            </div>
            <div
              class="bg-gradient-to-b from-brand-light-green to-brand-pale-green p-8 rounded-lg shadow-lg hover:shadow-2xl transition-all duration-300 border border-brand-dark-blue fade-in-up relative overflow-hidden hover:bg-opacity-90 hover:scale-[1.02]"
              id="consistencyContainer"
            >
              <div
                id="consistencyAnimationContainer"
                class="snellen-container absolute inset-0"
              ></div>
              <div class="text-brand-cyan mb-4 relative z-10">
                <img
                  src="assets/zakis.svg"
                  alt="Consistency"
                  class="w-20 h-20 mx-auto"
                />
              </div>
              <h3 class="text-xl text-white font-semibold mb-4 relative z-10">
                Stay Consistent
              </h3>
              <p class="text-white relative z-10">
                The team of Amblyfy believes the most important factor in
                successful amblyopia treatment is consistency. That's why we
                offer a personalized treatment plan tailored to your child's
                needs, ensuring the best possible outcome.
              </p>
            </div>
          </div>
        </div>
      </section>

      <section
        id="about"
        class="py-16 px-6 md:px-12 bg-gradient-to-br from-brand-cyan to-brand-dark-green"
      >
        <div
          class="container mx-auto flex flex-col md:flex-row items-center gap-12"
        >
          <div class="md:w-1/2 fade-in-up">
            <img
              src="assets/aboutUs.png"
              alt="About Us"
              class="rounded-lg shadow-xl w-full h-auto object-cover"
            />
          </div>
          <div
            class="md:w-1/2 text-center md:text-left fade-in-up"
            style="transition-delay: 0.1s"
          >
            <h2 class="text-3xl md:text-4xl font-bold text-white mb-6">
              Our Mission
            </h2>
            <p class="text-lg text-white mb-4">
              We are dedicated to developing innovative applications for the
              treatment of amblyopia. Our mission is to support children and
              their families by making the therapy journey more engaging,
              consistent, and effective. As part of this mission, we are
              creating an inspiring, child-friendly calendar designed to
              motivate daily participation and help parents and children stay on
              trackâ€”because consistency is key to successful amblyopia
              treatment.
            </p>
          </div>
        </div>
      </section>

      <section id="contact" class="py-16 px-6 md:px-12 bg-white">
        <div class="container mx-auto text-center max-w-2xl">
          <h2
            class="text-3xl md:text-4xl font-bold text-brand-dark-blue mb-8 fade-in-up"
          >
            Get in Touch
          </h2>
          <p
            class="text-lg text-brand-dark-blue mb-8 opacity-90 fade-in-up"
            style="transition-delay: 0.1s"
          >
            Have questions or want to learn more? Feel free to reach out to us!
          </p>
          <form
            id="contactForm"
            class="space-y-6 bg-white p-8 rounded-lg shadow-lg border border-brand-pale-green fade-in-up"
            style="transition-delay: 0.2s"
          >
            <div id="formStatus" class="hidden">
              <!-- Status messages will be inserted here -->
            </div>
            <div>
              <label
                for="name"
                class="block text-left text-brand-dark-blue text-sm font-semibold mb-2"
                >Name</label
              >
              <input
                type="text"
                id="name"
                name="name"
                maxlength="100"
                pattern="[A-Za-z\s\-']{2,100}"
                title="Please enter a valid name (2-100 characters, letters, spaces, hyphens, and apostrophes only)"
                class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-dark-blue"
                placeholder="Your Name"
                required
              />
              <span class="text-sm text-gray-500 mt-1 block"
                >Maximum 100 characters</span
              >
            </div>
            <div>
              <label
                for="email"
                class="block text-left text-brand-dark-blue text-sm font-semibold mb-2"
                >Email</label
              >
              <input
                type="email"
                id="email"
                name="email"
                maxlength="254"
                pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                title="Please enter a valid email address"
                class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-dark-blue"
                placeholder="your@example.com"
                required
              />
            </div>
            <div>
              <label
                for="message"
                class="block text-left text-brand-dark-blue text-sm font-semibold mb-2"
                >Message</label
              >
              <textarea
                id="message"
                name="message"
                rows="5"
                maxlength="1000"
                class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-dark-blue"
                placeholder="Your Message"
                required
              ></textarea>
              <span class="text-sm text-gray-500 mt-1 block"
                >Maximum 1000 characters</span
              >
            </div>
            <button
              type="submit"
              id="submitButton"
              class="w-full bg-brand-dark-blue text-white font-bold py-3 px-6 rounded-md shadow-md hover:bg-brand-cyan hover:scale-105 transition-all duration-300 ease-in-out transform"
            >
              Send Message
            </button>
          </form>
        </div>
      </section>
    </main>

    <button
      id="back-to-top"
      class="fixed bottom-6 right-6 bg-brand-dark-blue text-white p-3 rounded-full shadow-lg hidden hover:bg-brand-cyan focus:outline-none focus:ring-2 focus:ring-brand-dark-blue transition-all duration-300"
    >
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M5 10l7-7m0 0l7 7m-7-7v18"
        ></path>
      </svg>
    </button>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 py-8 w-full">
      <div class="w-full px-4">
        <div class="max-w-7xl mx-auto flex flex-col items-center space-y-4">
          <div class="flex space-x-6">
            <a
              href="#"
              class="text-gray-600 hover:text-brand-dark-blue transition-colors"
            >
              <svg
                class="w-6 h-6"
                fill="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z"
                />
              </svg>
            </a>
            <a
              href="#"
              class="text-gray-600 hover:text-brand-dark-blue transition-colors"
            >
              <svg
                class="w-6 h-6"
                fill="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"
                />
              </svg>
            </a>
            <a
              href="#"
              class="text-gray-600 hover:text-brand-dark-blue transition-colors"
            >
              <svg
                class="w-6 h-6"
                fill="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"
                />
              </svg>
            </a>
          </div>
          <p class="text-gray-600">&copy; 2025 Amblyfy. All rights reserved.</p>
          <div class="flex space-x-4 text-sm">
            <a
              href="/index.html"
              class="text-gray-600 hover:text-brand-dark-blue transition-colors"
              >Privacy Policy</a
            >
            <!-- To be changed to real privacy and stuff -->
            <a
              href="/index.html"
              class="text-gray-600 hover:text-brand-dark-blue transition-colors"
              >Terms of Service</a
            >
          </div>
        </div>
      </div>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // --- Mobile Menu Toggle ---
        const mobileMenuButton = document.getElementById("mobile-menu-button");
        const mobileMenu = document.getElementById("mobile-menu");
        const navLinks = mobileMenu.querySelectorAll("a");

        mobileMenuButton.addEventListener("click", function () {
          mobileMenu.classList.toggle("hidden");
        });

        // Close mobile menu when a link is clicked
        navLinks.forEach((link) => {
          link.addEventListener("click", function () {
            mobileMenu.classList.add("hidden");
          });
        });

        // --- Back to Top Button Functionality ---
        const backToTopButton = document.getElementById("back-to-top");

        window.addEventListener("scroll", function () {
          // Show button when scrolled down 200px, hide otherwise
          if (window.scrollY > 200) {
            backToTopButton.classList.remove("hidden");
          } else {
            backToTopButton.classList.add("hidden");
          }
        });

        backToTopButton.addEventListener("click", function () {
          window.scrollTo({
            top: 0,
            behavior: "smooth",
          });
        });

        // --- Scroll-Triggered Animations (Fade In Up) ---
        const animatedElements = document.querySelectorAll(".fade-in-up");

        const observerOptions = {
          root: null,
          rootMargin: "0px",
          threshold: 0.1,
        };

        const observer = new IntersectionObserver((entries, observer) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("is-visible");
              observer.unobserve(entry.target);
            }
          });
        }, observerOptions);

        animatedElements.forEach((element) => {
          observer.observe(element);
        });

        // --- Smooth Scrolling for Navigation Links ---
        document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
          anchor.addEventListener("click", function (e) {
            e.preventDefault();
            const targetId = this.getAttribute("href");
            const targetElement = document.querySelector(targetId);

            if (targetElement) {
              const headerOffset = 80; // Height of your fixed header
              const elementPosition = targetElement.getBoundingClientRect().top;
              const offsetPosition =
                elementPosition + window.pageYOffset - headerOffset;

              window.scrollTo({
                top: offsetPosition,
                behavior: "smooth",
              });
            }
          });
        });
      });
      // Get the container elements
      const snellenContainer = document.getElementById(
        "snellenAnimationContainer"
      );
      const startContainer = document.getElementById("startAnimationContainer");
      const consistencyContainer = document.getElementById(
        "consistencyAnimationContainer"
      );
      const testEyesContainer = document.getElementById("testEyesContainer");
      const startTreatmentContainer = document.getElementById(
        "startTreatmentContainer"
      );
      const consistencyContainerParent = document.getElementById(
        "consistencyContainer"
      );

      // Define the Snellen chart symbols
      const snellenSymbols = [
        "E",
        "F",
        "P",
        "T",
        "O",
        "Z",
        "L",
        "D",
        "C",
        "R",
        "U",
        "V",
      ];

      // Configuration for the animations
      const config = {
        numberOfSymbols: 20,
        minSize: 20,
        maxSize: 40,
        minSpeed: 0.2,
        maxSpeed: 0.8,
        spawnDelay: 200,
      };

      let animationFrameId = null;
      let isAnimationRunning = false;
      let isHovering = false;
      const symbols = [];

      function getRandom(min, max) {
        return Math.random() * (max - min) + min;
      }

      function updateSymbols(container) {
        if (!isAnimationRunning) return;

        const containerRect = container.getBoundingClientRect();

        symbols.forEach((symbol) => {
          symbol.x += symbol.directionX * symbol.speed;
          symbol.y += symbol.directionY * symbol.speed;

          if (symbol.x + symbol.size > containerRect.width || symbol.x < 0) {
            symbol.directionX *= -1;
            symbol.x = Math.max(
              0,
              Math.min(symbol.x, containerRect.width - symbol.size)
            );
          }

          if (symbol.y + symbol.size > containerRect.height || symbol.y < 0) {
            symbol.directionY *= -1;
            symbol.y = Math.max(
              0,
              Math.min(symbol.y, containerRect.height - symbol.size)
            );
          }

          symbol.element.style.left = `${symbol.x}px`;
          symbol.element.style.top = `${symbol.y}px`;
        });

        animationFrameId = requestAnimationFrame(() =>
          updateSymbols(container)
        );
      }

      function createSymbolElement(type) {
        const element = document.createElement("div");
        element.classList.add(
          type === "snellen"
            ? "snellen-symbol"
            : type === "start"
            ? "start-symbol"
            : "consistency-symbol"
        );

        if (type === "snellen") {
          element.textContent =
            snellenSymbols[Math.floor(Math.random() * snellenSymbols.length)];
        } else if (type === "start") {
          const img = document.createElement("img");
          img.src = "assets/eyeDocEquip.png";
          element.appendChild(img);
        } else {
          const img = document.createElement("img");
          img.src = "assets/zakis.png";
          element.appendChild(img);
        }

        return element;
      }

      function createSymbols(container, type) {
        const size = getRandom(config.minSize, config.maxSize);
        const speed = getRandom(config.minSpeed, config.maxSpeed);
        const element = createSymbolElement(type);
        element.style.fontSize = `${size}px`;

        const containerRect = container.getBoundingClientRect();
        const initialX = getRandom(0, containerRect.width - size);
        const initialY = getRandom(0, containerRect.height - size);

        element.style.left = `${initialX}px`;
        element.style.top = `${initialY}px`;

        const angle = getRandom(0, Math.PI * 2);

        return {
          element: element,
          x: initialX,
          y: initialY,
          size: size,
          speed: speed,
          directionX: Math.cos(angle),
          directionY: Math.sin(angle),
        };
      }

      function startAnimation(container) {
        if (isAnimationRunning) return;
        isAnimationRunning = true;
        clearSymbols(container);

        const type =
          container.id === "testEyesContainer"
            ? "snellen"
            : container.id === "startTreatmentContainer"
            ? "start"
            : "consistency";

        for (let i = 0; i < config.numberOfSymbols; i++) {
          const symbol = createSymbols(
            container.querySelector(".snellen-container"),
            type
          );
          container
            .querySelector(".snellen-container")
            .appendChild(symbol.element);
          symbols.push(symbol);
        }

        animationFrameId = requestAnimationFrame(() =>
          updateSymbols(container)
        );
      }

      function stopAnimation() {
        if (!isAnimationRunning) return;
        isAnimationRunning = false;
        cancelAnimationFrame(animationFrameId);
        clearSymbols();
      }

      function clearSymbols(container) {
        if (container) {
          container.querySelector(".snellen-container").innerHTML = "";
        }
        symbols.length = 0;
      }

      // Add event listeners to all containers
      [
        testEyesContainer,
        startTreatmentContainer,
        consistencyContainerParent,
      ].forEach((container) => {
        container.addEventListener("mouseenter", () => {
          isHovering = true;
          const animationContainer =
            container.querySelector(".snellen-container");
          animationContainer.style.opacity = "1";
          startAnimation(container);
        });

        container.addEventListener("mouseleave", () => {
          isHovering = false;
          const animationContainer =
            container.querySelector(".snellen-container");
          animationContainer.style.opacity = "0";
          stopAnimation();
        });
      });

      // Handle resize
      window.addEventListener("resize", () => {
        clearTimeout(window.resizeTimeout);
        window.resizeTimeout = setTimeout(() => {
          if (isHovering) {
            const activeContainer = document.querySelector(
              ".snellen-container:hover"
            )?.parentElement;
            if (activeContainer) {
              stopAnimation();
              startAnimation(activeContainer);
            }
          }
        }, 200);
      });

      // Initial setup
      window.onload = () => {
        clearSymbols();
        document.querySelectorAll(".snellen-container").forEach((container) => {
          container.style.opacity = "0";
        });
      };

      // Contact Form Handling
      document.addEventListener("DOMContentLoaded", function () {
        const supabaseClient = supabase.createClient(
          "https://temkhtebkbcidecterqz.supabase.co",
          "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRlbWtodGVia2JjaWRlY3RlcnF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5MzQwMDYsImV4cCI6MjA2NDUxMDAwNn0.6lK1CuirhFNRB-RVwMc-QPwirWlPUlNEbCjTPOg7B7E"
        );

        // Rate limiting
        const RATE_LIMIT_WINDOW = 3600000; // 1 hour in milliseconds
        const MAX_REQUESTS = 5; // Maximum requests per hour
        let requestCount = 0;
        let lastRequestTime = Date.now();

        // Input sanitization function
        function sanitizeInput(input) {
          return input
            .replace(/[<>]/g, "") // Remove < and > to prevent HTML injection
            .trim();
        }

        // Validate email format
        function isValidEmail(email) {
          const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
          return emailRegex.test(email);
        }

        // Check rate limit
        function checkRateLimit() {
          const now = Date.now();
          if (now - lastRequestTime > RATE_LIMIT_WINDOW) {
            requestCount = 0;
            lastRequestTime = now;
          }
          return requestCount < MAX_REQUESTS;
        }

        document
          .getElementById("contactForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();

            const formStatus = document.getElementById("formStatus");
            const submitButton = document.getElementById("submitButton");
            const originalButtonText = submitButton.textContent;

            // Get and sanitize form data
            const name = sanitizeInput(document.getElementById("name").value);
            const email = sanitizeInput(document.getElementById("email").value);
            const message = sanitizeInput(
              document.getElementById("message").value
            );

            // Validate inputs
            if (name.length < 2) {
              formStatus.className =
                "p-4 mb-4 rounded-md bg-red-100 text-red-700";
              formStatus.textContent =
                "Name must be at least 2 characters long.";
              return;
            }

            if (!isValidEmail(email)) {
              formStatus.className =
                "p-4 mb-4 rounded-md bg-red-100 text-red-700";
              formStatus.textContent = "Please enter a valid email address.";
              return;
            }

            if (message.length < 10) {
              formStatus.className =
                "p-4 mb-4 rounded-md bg-red-100 text-red-700";
              formStatus.textContent =
                "Message must be at least 10 characters long.";
              return;
            }

            // Check rate limit
            if (!checkRateLimit()) {
              formStatus.className =
                "p-4 mb-4 rounded-md bg-red-100 text-red-700";
              formStatus.textContent =
                "Too many requests. Please try again later.";
              return;
            }

            try {
              submitButton.disabled = true;
              submitButton.textContent = "Sending...";
              formStatus.className =
                "p-4 mb-4 rounded-md bg-blue-100 text-blue-700";
              formStatus.textContent = "Sending your message...";
              formStatus.classList.remove("hidden");

              const { error } = await supabaseClient.from("messages").insert([
                {
                  name,
                  email,
                  message,
                  created_at: new Date().toISOString(),
                },
              ]);

              if (error) {
                formStatus.className =
                  "p-4 mb-4 rounded-md bg-red-100 text-red-700";
                formStatus.textContent = "Error: " + error.message;
              } else {
                formStatus.className =
                  "p-4 mb-4 rounded-md bg-green-100 text-green-700";
                formStatus.textContent =
                  "Message sent successfully! We'll get back to you soon.";
                this.reset();
                requestCount++; // Increment request count on successful submission
              }
            } catch (err) {
              console.error("Error details:", err);
              formStatus.className =
                "p-4 mb-4 rounded-md bg-red-100 text-red-700";
              formStatus.textContent = `Failed to send message: ${err.message}. Please try again.`;
            } finally {
              submitButton.disabled = false;
              submitButton.textContent = originalButtonText;
            }
          });
      });
    </script>
  </body>
</html>
